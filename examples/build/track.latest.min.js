!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Track=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=function(){"use strict";function b(a){g.isUndefined(a)&&(a=!0),a?f.set("developer",!0):(f.set("developer",null),f.set("noSend",null))}function c(){b(!1),f.set("internalCounter",0),f.set("page_sent",!1)}function d(d){f.set("config",d),c(),d.hasOwnProperty("developer")&&(delete d.developer,b(),d.hasOwnProperty("noSend")&&(delete d.noSend,f.set("noSend",!0))),a("./src/javascript/core/send").init()}function e(){return h}var f=a("./src/javascript/core/settings"),g=a("./src/javascript/utils"),h="Track version 0.0.13";return{init:d,developer:b,destroy:c,toString:e,page:a("./src/javascript/page"),data:a("./src/javascript/data"),event:a("./src/javascript/event"),link:a("./src/javascript/link")}}()},{"./src/javascript/core/send":4,"./src/javascript/core/settings":5,"./src/javascript/data":7,"./src/javascript/event":8,"./src/javascript/link":9,"./src/javascript/page":10,"./src/javascript/utils":11}],2:[function(a,b){b.exports=function(b,c){"use strict";function d(a){return k.isUndefined(a)&&(a="t"+(new Date).valueOf()+"h"+b.history.length),l.clickID=a,a}function e(a){return k.isUndefined(a)&&(a=b.history.length+"."+1e3*Math.random()+"."+(new Date).getTime()+"."+k.hash(c.location.href+c.referrer)),a}function f(){return j.set("internalCounter",j.get("internalCounter")+1),j.get("internalCounter")}function g(a){return"undefined"!=typeof a?a:j.get("config")&&j.get("config").hasOwnProperty("userID")?j.get("config").userID:null}function h(a,b){k.isUndefined(b)&&(b=function(){});var c=k.merge(k.merge(l),k.merge(a,{callback:b}));c=k.merge({userID:g(c.userID),clickID:c.clickID,requestID:e(),counter:f()},c),k.log(c),i.addAndRun(c)}var i=a("./core/send"),j=a("./core/settings"),k=a("./utils"),l={async:!0,callback:function(){}};return{setClickID:d,getClickID:function(){return l.clickID},track:h}}(window,document)},{"./core/send":4,"./core/settings":5,"./utils":11}],3:[function(a,b){b.exports=function(){"use strict";var b=a("../utils"),c=a("./store"),d=function(a){if(b.isUndefined(a))throw new Error("You must specify a name for the queue.");return this.queue=[],this.storage=new c(a),this.storage.read()&&(this.queue=this.storage.read()),this};return d.prototype.all=function(){if(0===this.queue.length)return null;var a,b=[];for(a=0;a<this.queue.length;a+=1)b.push(this.queue[a].item);return b},d.prototype.first=function(){return 0===this.queue.length?null:this.queue[0].item},d.prototype.last=function(){return 0===this.queue.length?null:this.queue.slice(-1)[0].item},d.prototype.id=function(){return 1e4*Math.random()+"."+(new Date).getTime()},d.prototype.add=function(a){function c(a){e.queue.push({created_at:(new Date).valueOf(),id:e.id(),item:a})}var d,e=this;if(b.is(a,"object")&&a.constructor.toString().match(/array/i))for(d=0;d<a.length;d+=1)c(a[d]);else c(a);return e},d.prototype.replace=function(a){if(b.is(a,"object")&&a.constructor.toString().match(/array/i))return this.queue=[],this.add(a).save(),this;throw new Error("Argument invalid, must be an array.")},d.prototype.shift=function(){var a,b=this.all(),c=this.first();if(!c)return null;for(a=0;a<b.length;a+=1)if(c.requestID===b[a].requestID){b.splice(a,1),this.replace(b).save();break}return c},d.prototype.save=function(){return this.storage.write(this.queue),this},d}()},{"../utils":11,"./store":6}],4:[function(a,b){b.exports=function(b){"use strict";function c(a){p[a]=!0}function d(a){delete p[a]}function e(a){d(a);var b,c=k.all();for(b=0;b<c.length;b+=1)if(a===c[b].requestID){c.splice(b,1),k.replace(c).save();break}}function f(a,f){function g(b){m.is(n,"function")&&n.call(a,b),b.status>=200&&b.status<300?(e(a.requestID),f()):d(a.requestID)}var h,i=(new Date).getTime()-a.queueTime,j=new b.XMLHttpRequest,k=a.async,n=a.callback;delete a.callback,delete a.async,i>1e3&&26784e5>i&&(a.offlineLag=i),c(a.requestID),h=m.serialize(a),k&&(j.onreadystatechange=function(){4===j.readyState&&g(j)}),j.onerror=function(){g(j)},l.get("developer")&&l.get("noSend")||(j.open("POST",o,k),j.setRequestHeader("Content-type","application/x-www-form-urlencoded"),j.send(h)),k||g(j)}function g(a){a.queueTime=(new Date).getTime(),k.add(a).save(),l.get("developer")&&m.log("Queue",k)}function h(a){m.isUndefined(a)&&(a=function(){});var b=function(){h(),a()},c=k.first();return c?p[c.requestID]?a():f(c,b):a()}function i(a){g(a),h()}function j(){k=new n("requests"),l.get("config")&&l.get("config").server&&(o=l.get("config").server),b.addEventListener&&b.addEventListener("online",h),h()}var k,l=a("./settings"),m=a("../utils"),n=a("./queue"),o="http://test.tracking.ft.com",p={};return{init:j,add:g,run:h,addAndRun:i}}(window)},{"../utils":11,"./queue":3,"./settings":5}],5:[function(a,b){var c={internalCounter:0};b.exports=function(){"use strict";function a(a,b){c[a]=b}function b(a){return c[a]}function d(a){delete c[a]}return{set:a,get:b,"delete":d}}()},{}],6:[function(a,b){b.exports=function(){"use strict";var b=function(b,c){var d,e="o-tracking",f=a("../utils");if(f.isUndefined(b))throw new Error("You must specify a name for the store.");return this.config=f.merge({storage:"best",expires:"10 years"},c),this.data=null,this.storageKey=this.config.hasOwnProperty("nameOverride")?this.config.nameOverride:[e,b].join("_"),this.storage=function(a,b){function c(a){a+="=";var c,d,e=b.document.cookie.split(";");for(c=0;c<e.length;c+=1)if(d=e[c].trim(),0===d.indexOf(a))return d.substring(a.length,d.length);return null}function d(a,c,d){var e,g,h="";f.is(d,"number")&&(e=new Date,e.setTime(e.getTime()+24*d*60*60*1e3),h="expires="+e.toGMTString()+";"),g=f.encode(a)+"="+f.encode(c)+";"+h+"path=/;",b.document.cookie=g}function g(a){d(a,"",-1)}var h=e+"_InternalTest";if("cookie"!==a.storage)try{if(b.localStorage&&(b.localStorage.setItem(h,"TEST"),"TEST"===b.localStorage.getItem(h)))return b.localStorage.removeItem(h),{_type:"localStorage",load:function(a){return b.localStorage.getItem.call(b.localStorage,a)},save:function(a,c){return b.localStorage.setItem.call(b.localStorage,a,c)},remove:function(a){return b.localStorage.removeItem.call(b.localStorage,a)}}}catch(i){}return d(h,"TEST"),"TEST"===c(h)?(g(h),{_type:"cookie",load:c,save:d,remove:g}):{_type:"none",load:function(){},save:function(){},remove:function(){}}}(this.config,window),d=this.storage.load(this.storageKey),d&&(this.data=JSON.parse(d)),this};return b.prototype.read=function(){return this.data},b.prototype.write=function(a){return this.data=a,this.storage.save(this.storageKey,JSON.stringify(this.data)),this},b.prototype.destroy=function(){return this.data=null,this.storage.remove(this.storageKey),this},b}()},{"../utils":11}],7:[function(a,b){b.exports=function(b){"use strict";function c(a,b){a=e.merge(e.merge(f),a),d.track(a,b)}var d=a("./core"),e=a("./utils"),f={type:"data"};return b.Element.prototype.addEventListener||(b.Element.prototype.addEventListener=function(a,b){this.attachEvent("on"+a,b)}),b.addEventListener("oTracking.Data",c,!1),c}(window)},{"./core":2,"./utils":11}],8:[function(a,b){b.exports=function(b){"use strict";function c(a,b,c,g){var h=e.merge(e.merge(f),{eventModel:a,eventType:b,eventData:c});d.track(h,g)}var d=a("./core"),e=a("./utils"),f={type:"event"};return b.Element.prototype.addEventListener||(b.Element.prototype.addEventListener=function(a,b){this.attachEvent("on"+a,b)}),b.addEventListener("oTracking.Event",function(a){c(a.model,a.type,a.value)},!1),c}(window)},{"./core":2,"./utils":11}],9:[function(a,b){b.exports=function(b){"use strict";function c(a){return a.indexOf(b.document.location.hostname)>-1}function d(a){return!c(a)}function e(a){var b=a.replace(/^\w+:\/\//,"").replace(/(#|\?).+/g,"").replace(/\/$/,"");return-1===b.indexOf("/")?!1:b.match(/\.(\w{2,4})$/)?["html","htm","php"].indexOf(RegExp.$1)>-1?!1:!0:!1}function f(a){if(!a)return[];var b=[a];return"BODY"===a.nodeName?b:b.concat(f(a.parentElement))}function g(a){var b=f(a),c=a.href;return c=c.replace(/^http:\/\/[\w\.]+/,"").replace(/^\//,"").replace(/(\?|#).*$/,"").replace(/\/$/,"").replace(/\.[a-z]{3,4}$/,""),""===c&&(c=a.href.replace(/^http:\/\//,"").split("?")[0].replace(/\/$/,"")),c=c.split("/").slice(-2).filter(function(a){return a}),c.slice(-1)[0].match(/[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}/)&&(c=c.slice(-1)),c=(c.length>1?c.slice(0,2).join("-"):c[0]).toLowerCase(),b.map(function(a){return a.tagName.toLowerCase()}).filter(function(a,b,c){return c.lastIndexOf(a)===b}).reverse().join("/")+"/"+c}function h(a){var b=g(a),f=p.merge(p.merge(q),{requestPage:"",link:b,referrerClickID:o.getClickID()});return d(a.href)||e(a.href)?(f.async=!1,o.track(f,r)):(c(a.href)&&m.add(f).save(),!0)}function i(a){return h(a.target)}function j(a){r=a}function k(){var a=function(){k(),r()},b=m.shift();b&&o.track(b,a)}function l(a){var c,d;if(m=new n("links"),k(),"undefined"==typeof a&&(a={}),a=p.merge({root:b.document,selector:"a",event:"click",links:null},a),a.hasOwnProperty("callback")&&(r=a.callback),a.links&&"object"==typeof a.links&&a.links.constructor.toString().match(/array/i))for(c=a.links,d=0;d<c.length;d+=1)c[d].addEventListener(a.event,i,!1);else{if("object"!=typeof a.root||"string"!=typeof a.selector)throw"If supplying a config it must have a valid root element and a selector string";a.root.addEventListener(a.event,function(b){b.target.tagName===a.selector.toUpperCase()&&i.call(b.target,b)},!1)}}var m,n=a("./core/queue"),o=a("./core"),p=a("./utils"),q={type:"link"},r=function(){};return b.Element.prototype.addEventListener||(b.Element.prototype.addEventListener=function(a,b){this.attachEvent("on"+a,b)}),b.addEventListener("oTracking.Link",h,!1),{init:l,onClick:j,track:h}}(window)},{"./core":2,"./core/queue":3,"./utils":11}],10:[function(a,b){b.exports=function(b,c){"use strict";function d(a){if(g.isUndefined(a))throw new Error("URL must be specified");return-1===a.indexOf("://")&&("/"!==a.substring(0,1)&&(a="/"+a),a=c.location.protocol+"//"+c.location.hostname+a),-1===a.indexOf("?")?a+=b.location.search:a=a.substr(0,a.indexOf("?"))+"?"+g.serialize(g.merge(g.unserialize(b.location.search.substring(1)),g.unserialize(a.substr(a.indexOf("?")+1)))),a}var e=a("./core"),f=a("./core/settings"),g=a("./utils"),h={type:"page",url:c.URL,referrer:c.referrer,color:b.screen.colorDepth,screenRes:b.screen.width+"x"+b.screen.height,localTime:(new Date).toISOString(),java:b.navigator.javaEnabled()?"1":"0",js:"1",async:!0};return function(a,b){a=g.merge(g.merge(h),a),a.url=d(a.url),e.setClickID(),e.track(a,b),f.page_sent=!0}}(window,document)},{"./core":2,"./core/settings":5,"./utils":11}],11:[function(a,b){b.exports=function(b,c){"use strict";function d(){m.get("developer")&&b&&b.log.apply(null,arguments)}function e(a,b){return b||(b="undefined"),typeof a===b}function f(a,b){b||(b=a,a={});var c,d,e;for(c in b)d=a[c],e=b[c],a!==e&&"undefined"!=typeof e&&null!==e&&""!==e&&(a[c]=e);return a}function g(a){try{return c.encodeURIComponent(a)}catch(b){return c.escape(a)}}function h(a){try{return c.decodeURIComponent(a)}catch(b){return c.unescape(a)}}function i(a){if(!a)return"";var b,c=2166136261;for(b=0;b<a.length;b++)c+=(c<<1)+(c<<4)+(c<<7)+(c<<8)+(c<<24),c^=a.charCodeAt(b);return Number(4294967295&c).toString(16)}function j(a){if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}function k(a,b){var c,d=[];for(e(b)&&(b=[]),0===b.length&&(b=j(a)),c=0;c<b.length;c+=1)a.hasOwnProperty(b[c])&&d.push(b[c]+"="+g(a[b[c]]));return d.join("&")}function l(a){var b,c,d={};for(a=a.split("&"),b=0;b<a.length;b+=1)c=a[b].split("="),d[c[0]]=c.slice(1).join("=");return d}var m=a("./core/settings");return{log:d,is:e,isUndefined:e,merge:f,encode:g,unencode:h,hash:i,objectKeys:j,serialize:k,unserialize:l}}(console,window)},{"./core/settings":5}]},{},[1])(1)});