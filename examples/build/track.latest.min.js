!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Track=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=function(){"use strict";function b(a){g.isUndefined(a)&&(a=!0),a?f.set("developer",!0):(f.set("developer",null),f.set("noSend",null))}function c(){b(!1),f.set("internalCounter",0),f.set("page_sent",!1)}function d(d){f.set("config",d),c(),d.hasOwnProperty("developer")&&(delete d.developer,b(),d.hasOwnProperty("noSend")&&(delete d.noSend,f.set("noSend",!0))),a("./src/javascript/core/send").init(),a("./src/javascript/page")(d)}function e(){return h}var f=a("./src/javascript/core/settings"),g=a("./src/javascript/utils"),h="Track version 0.0.6";return{init:d,developer:b,destroy:c,toString:e,page:a("./src/javascript/page"),data:a("./src/javascript/data"),event:a("./src/javascript/event")}}()},{"./src/javascript/core/send":4,"./src/javascript/core/settings":5,"./src/javascript/data":7,"./src/javascript/event":8,"./src/javascript/page":9,"./src/javascript/utils":10}],2:[function(a,b){b.exports=function(b,c){"use strict";function d(a){return j.isUndefined(a)&&(a="t"+(new Date).valueOf()+"h"+b.history.length),k.clickID=a,a}function e(a){return j.isUndefined(a)&&(a=b.history.length+"."+1e3*Math.random()+"."+(new Date).getTime()+"."+j.hash(c.location.href+c.referrer)),a}function f(){return i.set("internalCounter",i.get("internalCounter")+1),i.get("internalCounter")}function g(a,b){j.isUndefined(b)&&(b=function(){});var c=j.merge(j.merge(k,i.config),j.merge(a,{callback:b}));c.requestID=e(),c=j.merge({clickID:c.clickID,requestID:c.requestID,counter:f()},c),j.log(c),h.addAndRun(c)}var h=a("./core/send"),i=a("./core/settings"),j=a("./utils"),k={environment:"test",async:!0,callback:function(){}};return{clickID:d,track:g}}(window,document)},{"./core/send":4,"./core/settings":5,"./utils":10}],3:[function(a,b){b.exports=function(){"use strict";var b=a("../utils"),c=a("./store"),d=function(a){if(b.isUndefined(a))throw new Error("You must specify a name for the queue.");return this.queue=[],this.storage=new c(a),this.storage.read()&&(this.queue=this.storage.read()),this};return d.prototype.all=function(){if(0===this.queue.length)return null;var a,b=[];for(a=0;a<this.queue.length;a+=1)b.push(this.queue[a].item);return b},d.prototype.first=function(){return 0===this.queue.length?null:this.queue[0].item},d.prototype.last=function(){return 0===this.queue.length?null:this.queue.slice(-1)[0].item},d.prototype.id=function(){return 1e4*Math.random()+"."+(new Date).getTime()},d.prototype.add=function(a){function c(a){e.queue.push({created_at:(new Date).valueOf(),id:e.id(),item:a})}var d,e=this;if(b.is(a,"object")&&a.constructor.toString().match(/array/i))for(d=0;d<a.length;d+=1)c(a[d]);else c(a);return e},d.prototype.replace=function(a){if(b.is(a,"object")&&a.constructor.toString().match(/array/i))return this.queue=[],this.add(a).save(),this;throw new Error("Argument invalid, must be an array.")},d.prototype.save=function(){return this.storage.write(this.queue),this},d}()},{"../utils":10,"./store":6}],4:[function(a,b){b.exports=function(b){"use strict";function c(a){p[a]=!0}function d(a){delete p[a]}function e(a){d(a);var b,c=k.all();for(b=0;b<c.length;b+=1)if(a===c[b].requestID){c.splice(b,1),k.replace(c).save();break}}function f(a,f){function g(b){m.is(n,"function")&&n.call(a,b),b.status>=200&&b.status<300?(e(a.requestID),f()):d(a.requestID)}var h,i=(new Date).getTime()-a.queueTime,j=new b.XMLHttpRequest,k=a.async,n=a.callback;delete a.callback,delete a.async,i>1e3&&26784e5>i&&(a.offlineLag=i),c(a.requestID),h=m.serialize(a),k&&(j.onreadystatechange=function(){4===j.readyState&&g(j)}),j.onerror=function(){g(j)},l.get("developer")&&l.get("noSend")||(j.open("POST",o,k),j.send(h)),k||g(j)}function g(a){a.queueTime=(new Date).getTime(),k.add(a).save(),l.get("developer")&&m.log("Queue",k)}function h(a){m.isUndefined(a)&&(a=function(){});var b=function(){h(),a()},c=k.first();return c?p[c.requestID]?a():void f(c,b):a()}function i(a){g(a),h()}function j(){k=new n("requests"),l.get("config")&&l.get("config").server&&(o=l.get("config").server),b.addEventListener&&b.addEventListener("online",h),h()}var k,l=a("./settings"),m=a("../utils"),n=a("./queue"),o="http://tracking.ft.com",p={};return{init:j,add:g,run:h,addAndRun:i}}(window)},{"../utils":10,"./queue":3,"./settings":5}],5:[function(a,b){var c={internalCounter:0};b.exports=function(){"use strict";function a(a,b){c[a]=b}function b(a){return c[a]}function d(a){delete c[a]}return{set:a,get:b,"delete":d}}()},{}],6:[function(a,b){b.exports=function(){"use strict";var b=function(b,c){var d=a("../utils");if(d.isUndefined(b))throw new Error("You must specify a name for the store.");this.config=d.merge({storage:"best",expires:"10 years"},c),this.data=null;var e,f="o-tracking-module";return this.storageKey=this.config.hasOwnProperty("nameOverride")?this.config.nameOverride:[f,b].join("_"),this.storage=function(a,b){function c(a){a+="=";var c,d,e=b.document.cookie.split(";");for(c=0;c<e.length;c+=1)if(d=e[c].trim(),0===d.indexOf(a))return d.substring(a.length,d.length);return null}function e(a,c,e){var f,g,h="";d.is(e,"number")&&(f=new Date,f.setTime(f.getTime()+24*e*60*60*1e3),h="expires="+f.toGMTString()+";"),g=d.encode(a)+"="+d.encode(c)+";"+h+"path=/;",b.document.cookie=g}function g(a){e(a,"",-1)}var h=f+"_InternalTest";if("cookie"!==a.storage)try{if(b.localStorage&&(b.localStorage.setItem(h,"TEST"),"TEST"===b.localStorage.getItem(h)))return b.localStorage.removeItem(h),{_type:"localStorage",load:function(a){return b.localStorage.getItem.call(b.localStorage,a)},save:function(a,c){return b.localStorage.setItem.call(b.localStorage,a,c)},remove:function(a){return b.localStorage.removeItem.call(b.localStorage,a)}}}catch(i){}return e(h,"TEST"),"TEST"===c(h)?(g(h),{_type:"cookie",load:c,save:e,remove:g}):{_type:"none",load:function(){},save:function(){},remove:function(){}}}(this.config,window),e=this.storage.load(this.storageKey),e&&(this.data=JSON.parse(e)),this};return b.prototype.read=function(){return this.data},b.prototype.write=function(a){return this.data=a,this.storage.save(this.storageKey,JSON.stringify(this.data)),this},b.prototype.destroy=function(){return this.data=null,this.storage.remove(this.storageKey),this},b}()},{"../utils":10}],7:[function(a,b){b.exports=function(b){"use strict";function c(a,b){a=e.merge(f,a),d.track(a,b)}var d=a("./core"),e=a("./utils"),f={type:"data"};return b.addEventListener("oTrackingData",c,!1),c}(window)},{"./core":2,"./utils":10}],8:[function(a,b){b.exports=function(b){"use strict";function c(a,b,c,g){var h=e.merge(f,{eventModel:a,eventType:b,eventData:c});d.track(h,g)}var d=a("./core"),e=a("./utils"),f={type:"event"};return b.addEventListener("oTrackingEvent",c,!1),c}(window)},{"./core":2,"./utils":10}],9:[function(a,b){b.exports=function(b,c){"use strict";function d(a){if(g.isUndefined(a))throw new Error("URL must be specified");return-1===a.indexOf("://")&&("/"!==a.substring(0,1)&&(a="/"+a),a=c.location.protocol+"//"+c.location.hostname+a),-1===a.indexOf("?")?a+=b.location.search:a=a.substr(0,a.indexOf("?"))+"?"+g.serialize(g.merge(g.unserialize(b.location.search.substring(1)),g.unserialize(a.substr(a.indexOf("?")+1)))),a}var e=a("./core"),f=a("./core/settings"),g=a("./utils"),h={type:"page",url:c.URL,referrer:c.referrer,color:b.screen.colorDepth,screenRes:b.screen.width+"x"+b.screen.height,localTime:(new Date).toISOString(),java:b.navigator.javaEnabled()?"1":"0",js:"1",async:!1};return function(a,b){a=g.merge(h,a),a.url=d(a.url),e.clickID(),e.track(a,b),f.page_sent=!0}}(window,document)},{"./core":2,"./core/settings":5,"./utils":10}],10:[function(a,b){b.exports=function(b,c){"use strict";function d(){m.get("developer")&&b&&b.log.apply(null,arguments)}function e(a,b){return b||(b="undefined"),typeof a===b}function f(a,b){b||(b=a,a={});var c,d,e;for(c in b)d=a[c],e=b[c],a!==e&&"undefined"!=typeof e&&null!==e&&""!==e&&(a[c]=e);return a}function g(a){try{return c.encodeURIComponent(a)}catch(b){return c.escape(a)}}function h(a){try{return c.decodeURIComponent(a)}catch(b){return c.unescape(a)}}function i(a){if(!a)return"";var b,c=2166136261;for(b=0;b<a.length;b++)c+=(c<<1)+(c<<4)+(c<<7)+(c<<8)+(c<<24),c^=a.charCodeAt(b);return Number(4294967295&c).toString(16)}function j(a){if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}function k(a,b){var c,d=[];for(e(b)&&(b=[]),0===b.length&&(b=j(a)),c=0;c<b.length;c+=1)a.hasOwnProperty(b[c])&&d.push(b[c]+"="+g(a[b[c]]));return d.join("&")}function l(a){var b,c,d={};for(a=a.split("&"),b=0;b<a.length;b+=1)c=a[b].split("="),d[c[0]]=c.slice(1).join("=");return d}var m=a("./core/settings");return{log:d,is:e,isUndefined:e,merge:f,encode:g,unencode:h,hash:i,objectKeys:j,serialize:k,unserialize:l}}(console,window)},{"./core/settings":5}]},{},[1])(1)});