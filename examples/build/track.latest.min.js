!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Track=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=function(){"use strict";function b(a){g.isUndefined(a)&&(a=!0),a?f.set("developer",!0):(f.set("developer",null),f.set("noSend",null))}function c(){b(!1),f.set("internalCounter",0),f.set("page_sent",!1)}function d(d){f.set("config",d),c(),d.hasOwnProperty("developer")&&(delete d.developer,b(),d.hasOwnProperty("noSend")&&(delete d.noSend,f.set("noSend",!0))),a("./src/javascript/core/user").init(d.userID),a("./src/javascript/core/send").init()}function e(){return h}var f=a("./src/javascript/core/settings"),g=a("./src/javascript/utils"),h="Track version 0.0.17";return{init:d,developer:b,destroy:c,toString:e,page:a("./src/javascript/page"),data:a("./src/javascript/data"),event:a("./src/javascript/event"),link:a("./src/javascript/link")}}()},{"./src/javascript/core/send":4,"./src/javascript/core/settings":5,"./src/javascript/core/user":7,"./src/javascript/data":8,"./src/javascript/event":9,"./src/javascript/link":10,"./src/javascript/page":11,"./src/javascript/utils":12}],2:[function(a,b){b.exports=function(b){"use strict";function c(a){return j.isUndefined(a)&&(a="t"+(new Date).valueOf()+"h"+b.history.length),k.clickID=a,a}function d(a){return j.isUndefined(a)&&(a=j.createUniqueID()),a}function e(){return i.set("internalCounter",i.get("internalCounter")+1),i.get("internalCounter")}function f(a,b){j.isUndefined(b)&&(b=function(){});var c=j.merge(j.merge(k),j.merge(a,{callback:b}));c=j.merge({userID:h.userID(),clickID:c.clickID,requestID:d(),counter:e()},c),j.log(c),g.addAndRun(c)}var g=a("./core/send"),h=a("./core/user"),i=a("./core/settings"),j=a("./utils"),k={async:!0,callback:function(){}};return{setClickID:c,getClickID:function(){return k.clickID},track:f}}(window)},{"./core/send":4,"./core/settings":5,"./core/user":7,"./utils":12}],3:[function(a,b){b.exports=function(){"use strict";var b=a("../utils"),c=a("./store"),d=function(a){if(b.isUndefined(a))throw new Error("You must specify a name for the queue.");return this.queue=[],this.storage=new c(a),this.storage.read()&&(this.queue=this.storage.read()),this};return d.prototype.all=function(){if(0===this.queue.length)return null;var a,b=[];for(a=0;a<this.queue.length;a+=1)b.push(this.queue[a].item);return b},d.prototype.first=function(){return 0===this.queue.length?null:this.queue[0].item},d.prototype.last=function(){return 0===this.queue.length?null:this.queue.slice(-1)[0].item},d.prototype.id=function(){return 1e4*Math.random()+"."+(new Date).getTime()},d.prototype.add=function(a){function c(a){e.queue.push({created_at:(new Date).valueOf(),id:e.id(),item:a})}var d,e=this;if(b.is(a,"object")&&a.constructor.toString().match(/array/i))for(d=0;d<a.length;d+=1)c(a[d]);else c(a);return e},d.prototype.replace=function(a){if(b.is(a,"object")&&a.constructor.toString().match(/array/i))return this.queue=[],this.add(a).save(),this;throw new Error("Argument invalid, must be an array.")},d.prototype.shift=function(){var a,b=this.all(),c=this.first();if(!c)return null;for(a=0;a<b.length;a+=1)if(c.requestID===b[a].requestID){b.splice(a,1),this.replace(b).save();break}return c},d.prototype.save=function(){return this.storage.write(this.queue),this},d}()},{"../utils":12,"./store":6}],4:[function(a,b){b.exports=function(b){"use strict";function c(){try{var a=new b.XMLHttpRequest;if("undefined"!=typeof a.withCredentials)return{xmlHttp:a,XDomainRequest:!1};if("undefined"!=typeof b.XDomainRequest)return{xmlHttp:new b.XDomainRequest,XDomainRequest:!0}}catch(c){try{return{xmlHttp:new b.ActiveXObject("Microsoft.XMLHTTP"),XDomainRequest:!1}}catch(d){}}return null}function d(a){q[a]=!0}function e(a){delete q[a]}function f(a){e(a);var b,c=l.all();for(b=0;b<c.length;b+=1)if(a===c[b].requestID){c.splice(b,1),l.replace(c).save();break}}function g(a,b){function g(c){n.is(l,"function")&&l.call(a,c),c.status>=200&&c.status<300?(f(a.requestID),b()):e(a.requestID)}var h,i,j=(new Date).getTime()-a.queueTime,k=c(),l=a.callback;k&&(i=k.xmlHttp,delete a.callback,delete a.async,j>1e3&&26784e5>j&&(a.offlineLag=j),d(a.requestID),h=n.serialize(a),k.XDomainRequest?i.onload=function(){g(i)}:i.onreadystatechange=function(){4===i.readyState&&g(i)},i.onerror=function(){g(i)},m.get("developer")&&m.get("noSend")||(i.open("POST",p,!0),k.XDomainRequest||i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(h)))}function h(a){a.queueTime=(new Date).getTime(),l.add(a).save(),m.get("developer")&&n.log("Queue",l)}function i(a){n.isUndefined(a)&&(a=function(){});var b=function(){i(),a()},c=l.first();return c?q[c.requestID]?a():g(c,b):a()}function j(a){h(a),i()}function k(){l=new o("requests"),m.get("config")&&m.get("config").server&&(p=m.get("config").server),n.addEvent(b,"online",i),i()}var l,m=a("./settings"),n=a("../utils"),o=a("./queue"),p="http://test.tracking.ft.com",q={};return{init:k,add:h,run:i,addAndRun:j}}(window)},{"../utils":12,"./queue":3,"./settings":5}],5:[function(a,b){var c={internalCounter:0};b.exports=function(){"use strict";function a(a,b){c[a]=b}function b(a){return c[a]}function d(a){delete c[a]}return{set:a,get:b,"delete":d}}()},{}],6:[function(a,b){b.exports=function(){"use strict";var b=function(b,c){var d,e="o-tracking",f=a("../utils");if(f.isUndefined(b))throw new Error("You must specify a name for the store.");if(this.config=f.merge({storage:"best",expires:3650},c),this.data=null,this.storageKey=this.config.hasOwnProperty("nameOverride")?this.config.nameOverride:[e,b].join("_"),this.storage=function(a,b){function c(a){a+="=";var c,d,e=b.document.cookie.split(";");for(c=0;c<e.length;c+=1)if(d=e[c].replace(/^\s+|\s+$/g,""),0===d.indexOf(a))return d.substring(a.length,d.length);return null}function d(a,c,d){var e,g,h="";f.is(d,"number")&&(e=new Date,e.setTime(e.getTime()+24*d*60*60*1e3),h="expires="+e.toGMTString()+";"),g=f.encode(a)+"="+f.encode(c)+";"+h+"path=/;",b.document.cookie=g}function g(a){d(a,"",-1)}var h=e+"_InternalTest";if("cookie"!==a.storage)try{if(b.localStorage&&(b.localStorage.setItem(h,"TEST"),"TEST"===b.localStorage.getItem(h)))return b.localStorage.removeItem(h),{_type:"localStorage",load:function(a){return b.localStorage.getItem.call(b.localStorage,a)},save:function(a,c){return b.localStorage.setItem.call(b.localStorage,a,c)},remove:function(a){return b.localStorage.removeItem.call(b.localStorage,a)}}}catch(i){}return d(h,"TEST"),"TEST"===c(h)?(g(h),{_type:"cookie",load:c,save:d,remove:g}):{_type:"none",load:function(){},save:function(){},remove:function(){}}}(this.config,window),d=this.storage.load(this.storageKey))try{this.data=JSON.parse(d)}catch(g){this.data=d}return this};return b.prototype.read=function(){return this.data},b.prototype.write=function(a){return this.data=a,this.storage.save(this.storageKey,"string"==typeof this.data?this.data:JSON.stringify(this.data),this.config.expires),this},b.prototype.destroy=function(){return this.data=null,this.storage.remove(this.storageKey),this},b}()},{"../utils":12}],7:[function(a,b){var c;b.exports=function(){"use strict";function b(a){"string"==typeof a&&(a={value:a}),"undefined"==typeof a&&(a={});var b,g=e.merge(d,a);return"cookie"===g.storage&&a.name&&(g.nameOverride=g.name),b=new f(g.name,g),c=b.read(),c||(c=g.value),c||(c=e.b64encode(e.createUniqueID())),b.write(c),c}var d={storage:"best",name:"userID",value:null},e=a("../utils"),f=a("./store");return{init:b,userID:function(){return c}}}()},{"../utils":12,"./store":6}],8:[function(a,b){b.exports=function(b){"use strict";function c(a,b){a=e.merge(e.merge(f),a),d.track(a,b)}var d=a("./core"),e=a("./utils"),f={type:"data"};return e.addEvent(b,"oTracking.Data",c),c}(window)},{"./core":2,"./utils":12}],9:[function(a,b){b.exports=function(b){"use strict";function c(a,b,c,g){var h=e.merge(e.merge(f),{eventModel:a,eventType:b,eventData:c});d.track(h,g)}var d=a("./core"),e=a("./utils"),f={type:"event"};return e.addEvent(b,"oTracking.Event",function(a){c(a.model,a.type,a.value)}),c}(window)},{"./core":2,"./utils":12}],10:[function(a,b){b.exports=function(b){"use strict";function c(a){return a.indexOf(b.document.location.hostname)>-1}function d(a){return!c(a)}function e(a){var b=a.replace(/^\w+:\/\//,"").replace(/(#|\?).+/g,"").replace(/\/$/,"");return-1===b.indexOf("/")?!1:b.match(/\.(\w{2,4})$/)?["html","htm","php"].indexOf(RegExp.$1)>-1?!1:!0:!1}function f(a){if(!a)return[];var b=[a];return"BODY"===a.nodeName?b:b.concat(f(a.parentElement))}function g(a){var b=f(a),c=a.href;return c=c.replace(/^http:\/\/[\w\.]+/,"").replace(/^\//,"").replace(/(\?|#).*$/,"").replace(/\/$/,"").replace(/\.[a-z]{3,4}$/,""),""===c&&(c=a.href.replace(/^http:\/\//,"").split("?")[0].replace(/\/$/,"")),c=c.split("/").slice(-2).filter(function(a){return a}),c.slice(-1)[0].match(/[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}/)&&(c=c.slice(-1)),c=(c.length>1?c.slice(0,2).join("-"):c[0]).toLowerCase(),b.map(function(a){return a.tagName.toLowerCase()}).filter(function(a,b,c){return c.lastIndexOf(a)===b}).reverse().join("/")+"/"+c}function h(a){var b=g(a),f=p.merge(p.merge(q),{requestPage:"",link:b,referrerClickID:o.getClickID()});return d(a.href)||e(a.href)?(f.async=!1,o.track(f,r)):(c(a.href)&&m.add(f).save(),!0)}function i(a){return h(a.target)}function j(a){r=a}function k(){var a=function(){k(),r()},b=m.shift();b&&o.track(b,a)}function l(a){var c,d;if(m=new n("links"),k(),"undefined"==typeof a&&(a={}),a=p.merge({root:b.document,selector:"a",event:"click",links:null},a),a.hasOwnProperty("callback")&&(r=a.callback),a.links&&"object"==typeof a.links&&a.links.constructor.toString().match(/array/i))for(c=a.links,d=0;d<c.length;d+=1)p.addEvent(c[d],a.event,i);else{if("object"!=typeof a.root||"string"!=typeof a.selector)throw"If supplying a config it must have a valid root element and a selector string";p.addEvent(a.root,a.event,function(b){b.target.tagName===a.selector.toUpperCase()&&i.call(b.target,b)})}}var m,n=a("./core/queue"),o=a("./core"),p=a("./utils"),q={type:"link"},r=function(){};return p.addEvent(b,"oTracking.Link",h),{init:l,onClick:j,track:h}}(window)},{"./core":2,"./core/queue":3,"./utils":12}],11:[function(a,b){b.exports=function(b,c){"use strict";function d(a){if(g.isUndefined(a))throw new Error("URL must be specified");return-1===a.indexOf("://")&&("/"!==a.substring(0,1)&&(a="/"+a),a=c.location.protocol+"//"+c.location.hostname+a),-1===a.indexOf("?")?a+=b.location.search:a=a.substr(0,a.indexOf("?"))+"?"+g.serialize(g.merge(g.unserialize(b.location.search.substring(1)),g.unserialize(a.substr(a.indexOf("?")+1)))),a}var e=a("./core"),f=a("./core/settings"),g=a("./utils"),h={type:"page",url:c.URL,referrer:c.referrer,color:b.screen.colorDepth,screenRes:b.screen.width+"x"+b.screen.height,localTime:g.toISOString(new Date),java:b.navigator.javaEnabled()?"1":"0",js:"1",async:!0};return function(a,b){a=g.merge(g.merge(h),a),a.url=d(a.url),e.setClickID(),e.track(a,b),f.page_sent=!0}}(window,document)},{"./core":2,"./core/settings":5,"./utils":12}],12:[function(a,b){b.exports=function(b){"use strict";function c(){r.get("developer")&&b.console&&b.console.log.apply(null,arguments)}function d(a,b){return b||(b="undefined"),typeof a===b}function e(a,b){b||(b=a,a={});var c,d,e;for(c in b)d=a[c],e=b[c],a!==e&&"undefined"!=typeof e&&null!==e&&""!==e&&(a[c]=e);return a}function f(a){try{return b.encodeURIComponent(a)}catch(c){return b.escape(a)}}function g(a){try{return b.decodeURIComponent(a)}catch(c){return b.unescape(a)}}function h(a){if(!a)return"";if(a=f(a),b.btoa)return b.btoa(a);var c,d,e,g="";for(c=0;c<a.length;c+=3)d=a.length-c,e=0,e=a.charCodeAt(c)<<16&16711680,e|=d>1?a.charCodeAt(c+1)<<8&65280:0,e|=d>2?255&a.charCodeAt(c+2):0,g+=q.charAt((16515072&e)>>18),g+=q.charAt((258048&e)>>12),g+=d>1?q.charAt((4032&e)>>6):"_",g+=d>2?q.charAt(63&e):"_";return g}function i(a){if(!a)return"";var b,c=2166136261;for(b=0;b<a.length;b++)c+=(c<<1)+(c<<4)+(c<<7)+(c<<8)+(c<<24),c^=a.charCodeAt(b);return Number(4294967295&c).toString(16)}function j(a){if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");if(Object.hasOwnProperty("keys"))return Object.keys(a);var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}function k(a,b){var c,e=[];for(d(b)&&(b=[]),0===b.length&&(b=j(a)),c=0;c<b.length;c+=1)a.hasOwnProperty(b[c])&&e.push(b[c]+"="+f(a[b[c]]));return e.join("&")}function l(a){var b,c,d={};for(a=a.split("&"),b=0;b<a.length;b+=1)c=a[b].split("="),d[c[0]]=c.slice(1).join("=");return d}function m(a){var b=String(a);return 1===b.length&&(b="0"+b),b}function n(a){return Date.prototype.hasOwnProperty("toISOString")?a.toISOString():[a.getUTCFullYear(),"-",m(a.getUTCMonth()+1),"-",m(a.getUTCDate()),"T",m(a.getUTCHours()),":",m(a.getUTCMinutes()),":",m(a.getUTCSeconds()),".",String((a.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5),"Z"].join("")}function o(){return b.history.length+"."+1e3*Math.random()+"."+(new Date).getTime()+"."+i(b.document.location.href+b.document.referrer)}function p(a,b,c){try{a.addEventListener(b,c,!1)}catch(d){try{a.attachEvent("on"+b,c)}catch(e){}}}var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=a("./core/settings");return{log:c,is:d,isUndefined:d,merge:e,encode:f,unencode:g,hash:i,objectKeys:j,serialize:k,unserialize:l,b64encode:h,toISOString:n,createUniqueID:o,addEvent:p}}(window)},{"./core/settings":5}]},{},[1])(1)});