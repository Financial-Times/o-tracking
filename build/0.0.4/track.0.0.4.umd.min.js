!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("track",[],b):a.track=b()}(this,function(){var a=function(a){"use strict";var b=a._self=a._self||{};return a.version="Track version 0.0.4",a.developer=function(c){a._Utils.isUndefined(c)&&(c=!0),c?b.developer=!0:(b.developer=null,b.noSend=null)},a.init=function(c){b.config=c,a.destroy(),c.hasOwnProperty("developer")&&(delete c.developer,a.developer(),c.hasOwnProperty("noSend")&&(delete c.noSend,b.noSend=!0)),a._Core.Send.init(),a.page()},a.destroy=function(){a.developer(!1),b.internalCounter=0,b.page_sent=!1},a.toString=function(){return a.version},a}({});return a._Utils=function(a,b,c){"use strict";function d(){m.developer&&b&&b.log.apply(null,arguments)}function e(a,b){return b||(b="undefined"),typeof a===b}function f(a,b){b||(b=a,a={});var c,d,e;for(c in b)d=a[c],e=b[c],a!==e&&"undefined"!=typeof e&&null!==e&&(a[c]=e);return a}function g(a){try{return c.encodeURIComponent(a)}catch(b){return c.escape(a)}}function h(a){try{return c.decodeURIComponent(a)}catch(b){return c.unescape(a)}}function i(a){if(!a)return"";var b,c=2166136261;for(b=0;b<a.length;b++)c+=(c<<1)+(c<<4)+(c<<7)+(c<<8)+(c<<24),c^=a.charCodeAt(b);return Number(4294967295&c).toString(16)}function j(a){if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}function k(a,b){var c,d=[];for(e(b)&&(b=[]),0===b.length&&(b=j(a)),c=0;c<b.length;c+=1)a.hasOwnProperty(b[c])&&d.push(b[c]+"="+g(a[b[c]]));return d.join("&")}function l(a){var b,c,d={};for(a=a.split("&"),b=0;b<a.length;b+=1)c=a[b].split("="),d[c[0]]=c.slice(1).join("=");return d}var m=a._self=a._self||{};return{log:d,is:e,isUndefined:e,merge:f,encode:g,unencode:h,hash:i,objectKeys:j,serialize:k,unserialize:l}}(a,console,window),a._Core=function(a,b,c){"use strict";function d(a){return i.isUndefined(a)&&(a="t"+(new Date).valueOf()+"h"+b.history.length),j.clickID=a,a}function e(a){return i.isUndefined(a)&&(a=b.history.length+"."+1e3*Math.random()+"."+(new Date).getTime()+"."+i.hash(c.location.href+c.referrer)),a}function f(){return h.internalCounter=h.internalCounter+1,h.internalCounter}function g(b,c){i.isUndefined(c)&&(c=function(){});var d=i.merge(i.merge(j,h.config),i.merge(b,{callback:c}));d.requestID=e(),d.values=i.merge({c:"",t:d.clickID,u:d.requestID,o:f()},d.values),i.log(d),a._Core.Send.addAndRun(d)}var h=a._self=a._self||{},i=a._Utils,j={environment:"test",async:!0,callback:function(){}};return{clickID:d,track:g}}(a,window,document),a._Core.Queue=function(b){"use strict";if(a._Utils.isUndefined(b))throw new Error("You must specify a name for the queue.");return this.queue=[],this.storage=new a._Core.Store(b),this.storage.read()&&(this.queue=this.storage.read()),this},a._Core.Queue.prototype.all=function(){"use strict";if(0===this.queue.length)return null;var a,b=[];for(a=0;a<this.queue.length;a+=1)b.push(this.queue[a].item);return b},a._Core.Queue.prototype.first=function(){"use strict";return 0===this.queue.length?null:this.queue[0].item},a._Core.Queue.prototype.last=function(){"use strict";return 0===this.queue.length?null:this.queue.slice(-1).item},a._Core.Queue.prototype.id=function(){"use strict";return 1e4*Math.random()+"."+(new Date).getTime()},a._Core.Queue.prototype.add=function(b){"use strict";function c(a){e.queue.push({created_at:(new Date).valueOf(),id:e.id(),item:a})}var d,e=this;if(a._Utils.is(b,"object")&&b.constructor.toString().match(/array/i))for(d=0;d<b.length;d+=1)c(b[d]);else c(b);return e},a._Core.Queue.prototype.replace=function(b){"use strict";if(a._Utils.is(b,"object")&&b.constructor.toString().match(/array/i))return this.queue=[],this.add(b).save(),this;throw new Error("Argument invalid, must be an array.")},a._Core.Queue.prototype.save=function(){"use strict";return this.storage.write(this.queue),this},a._Core.Send=function(b,c){"use strict";function d(a){v[a]=!0}function e(a){delete v[a]}function f(a){e(a);var b,c=p.all();for(b=0;b<c.length;b+=1)if(a===c[b].requestID){c.splice(b,1),p.replace(c).save();break}}function g(a){var b,c,d=1,e=0;for(b=0;b<a.length;b+=1)d+=a.charCodeAt(b),e+=d;return d%=65521,e%=65521,c=65536*e+d,c.toString(16)}function h(a){if(!a)return"";try{return c.btoa(r.unencode(r.encode(a)))}catch(b){var d,e,f,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=[];for(d=0;d<a.length;d+=3)e=a.length-d,f=0,f=a.charCodeAt(d)<<16&16711680,f|=e>1?a.charCodeAt(d+1)<<8&65280:0,f|=e>2?255&a.charCodeAt(d+2):0,h.push(g.charAt((16515072&f)>>18)),h.push(g.charAt((258048&f)>>12)),h.push(e>1?g.charAt((4032&f)>>6):"_"),h.push(e>2?g.charAt(63&f):"_");return h.join("")}}function i(a,b){a=a.split("");var c,d=[];for(c=0;c<a.length;c+=1)d.push(h(b[a[c]]));return d.join("*")+"*"}function j(a){return("production"===a?s:t)+u}function k(a,b){function h(){r.is(a.callback,"function")&&a.callback.call(a,n),n.status>=200&&n.status<300?(f(a.requestID),b()):e(a.requestID)}var k,l,m,n,o=(new Date).getTime()-a.queueTime;o>1e3&&26784e5>o&&(a.offlineLag=o,a.values.p+=(-1===a.values.p.indexOf("?")?"?":"&")+"offlineLag="+o),k="f="+a.format+"&d="+i(a.format,a.values),l="&c="+g(k);try{n=new c.XMLHttpRequest}catch(p){try{n=new c.ActiveXObject("Microsoft.XMLHttp")}catch(s){}}a.async&&(n.onreadystatechange=function(){4===n.readyState&&h()},n.onerror=h),d(a.requestID),m=[k,l].join(""),q.developer&&r.log(j(a.environment)+"?"+m),q.developer&&q.noSend||(n.open("POST",j(a.environment),a.async),n.send(m)),a.async||h()}function l(a){a.queueTime=(new Date).getTime(),p.add(a).save(),q.developer&&r.log("Queue",p)}function m(){var a=p.first();a&&k(a,m)}function n(a){l(a),m()}function o(){p=new a._Core.Queue("requests"),c.addEventListener&&c.addEventListener("online",m),m()}var p,q=b._self=b._self||{},r=b._Utils,s="http://stats.ft.com",t="http://statstest.ft.com",u="/si/track.gif",v={};return{init:o,add:l,run:m,addAndRun:n}}(a,window),a._Core.Store=function(b,c){"use strict";if(a._Utils.isUndefined(b))throw new Error("You must specify a name for the store.");this.config=a._Utils.merge({storage:"best",expires:"10 years"},c),this.data=null;var d,e="o-tracking-module";return this.storageKey=[e,b].join("_"),this.storage=function(b,c){function d(a){a+="=";var b,d,e=c.document.cookie.split(";");for(b=0;b<e.length;b+=1)if(d=e[b].trim(),0===d.indexOf(a))return d.substring(a.length,d.length);return null}function f(b,d,e){var f,g,h="";a._Utils.is(e,"number")&&(f=new Date,f.setTime(f.getTime()+24*e*60*60*1e3),h="expires="+f.toGMTString()+";"),g=a._Utils.encode(b)+"="+a._Utils.encode(d)+";"+h+"path=/;",c.document.cookie=g}function g(a){f(a,"",-1)}var h=e+"_InternalTest";if("cookie"!==b.storage)try{if(c.localStorage&&(c.localStorage.setItem(h,"TEST"),"TEST"===c.localStorage.getItem(h)))return c.localStorage.removeItem(h),{_type:"localStorage",load:function(a){return c.localStorage.getItem.call(c.localStorage,a)},save:function(a,b){return c.localStorage.setItem.call(c.localStorage,a,b)},remove:function(a){return c.localStorage.removeItem.call(c.localStorage,a)}}}catch(i){}return f(h,"TEST"),"TEST"===d(h)?(g(h),{_type:"cookie",load:d,save:f,remove:g}):{_type:"none",load:function(){},save:function(){},remove:function(){}}}(this.config,window),d=this.storage.load(this.storageKey),d&&(this.data=JSON.parse(d)),this},a._Core.Store.prototype.read=function(){"use strict";return this.data},a._Core.Store.prototype.write=function(a){"use strict";return this.data=a,this.storage.save(this.storageKey,JSON.stringify(this.data)),this},a._Core.Store.prototype.destroy=function(){"use strict";return this.data=null,this.storage.remove(this.storageKey),this},a.page=function(a,b,c){"use strict";function d(a){if(g.isUndefined(a))throw new Error("URL must be specified");return-1===a.indexOf("://")&&("/"!==a.substring(0,1)&&(a="/"+a),a=c.location.protocol+"//"+c.location.hostname+a),-1===a.indexOf("?")?a+=b.location.search:a=a.substr(0,a.indexOf("?"))+"?"+g.serialize(g.merge(g.unserialize(b.location.search.substring(1)),g.unserialize(a.substr(a.indexOf("?")+1)))),a}var e="pcrtgyuo",f=a._self=a._self||{},g=a._Utils,h={url:c.URL,referrer:c.referrer,co:b.screen.colorDepth,sr:b.screen.width+"x"+b.screen.height,lt:(new Date).toISOString(),jv:b.navigator.javaEnabled()?"1":"0",async:!1};return function(b,c){b=g.merge(h,b),a._Core.clickID(),a._Core.track({async:b.async,format:e,values:{p:d(b.url),r:b.referrer,g:g.serialize(b,["co","sr","lt","jv"]),y:"page"}},c),f.page_sent=!0}}(a,window,document),a});