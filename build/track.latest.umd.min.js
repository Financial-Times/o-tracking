!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("track",[],b):a.track=b()}(this,function(){var a=function(a){"use strict";var b=a._self=a._self||{};return a.version="Track version 0.0.4",a.developer=function(c){a._Utils.isUndefined(c)&&(c=!0),b.developer=c?!0:null},a.init=function(c){b.config=c,a.destroy(),c.hasOwnProperty("developer")&&(delete c.developer,a.developer()),a.page()},a.destroy=function(){a.developer(!1),b.internalCounter=0,b.page_sent=!1},a.toString=function(){return a.version},a}({});return a._Core=function(a,b,c){"use strict";function d(c){return a._Utils.isUndefined(c)&&(c="t"+(new Date).valueOf()+"h"+b.history.length),i.clickID=c,c}function e(d){return a._Utils.isUndefined(d)&&(d=b.history.length+"."+1e3*Math.random()+"."+(new Date).getTime()+"."+a._Utils.hash(c.location.href+c.referrer)),d}function f(){return h.internalCounter=h.internalCounter+1,h.internalCounter}function g(b,c){a._Utils.isUndefined(c)&&(c=function(){}),b=a._Utils.merge(a._Utils.merge(i,h.config),a._Utils.merge(b,{callback:c})),b.requestID=e(),b.values=a._Utils.merge({c:"",t:b.clickID,u:b.requestID,o:f()},b.values),a._Utils.log(b)}var h=a._self=a._self||{},i={environment:"test",async:!0,callback:function(){}};return{clickID:d,track:g}}(a,window,document),a.page=function(a,b,c){"use strict";function d(d){if(a._Utils.isUndefined(d))throw new Error("URL must be specified");return-1===d.indexOf("://")&&("/"!==d.substring(0,1)&&(d="/"+d),d=c.location.protocol+"//"+c.location.hostname+d),-1===d.indexOf("?")?d+=b.location.search:d=d.substr(0,d.indexOf("?"))+"?"+a._Utils.serialize(a._Utils.merge(a._Utils.unserialize(b.location.search.substring(1)),a._Utils.unserialize(d.substr(d.indexOf("?")+1)))),d}var e="pcrtgyuo",f=a._self=a._self||{},g={url:c.URL,referrer:c.referrer,co:b.screen.colorDepth,sr:b.screen.width+"x"+b.screen.height,lt:(new Date).toISOString(),jv:"",async:!1};return function(b,c){b=a._Utils.merge(g,b),a._Core.clickID(),a._Core.track({async:b.async,format:e,values:{p:d(b.url),r:b.referrer,g:a._Utils.serialize(b,["co","sr","lt","jv"]),y:"page"}},c),f.page_sent=!0}}(a,window,document),a._Core.Send=function(a,b){"use strict";function c(a){w[a]=!0}function d(a){delete w[a]}function e(){try{if(!b.localStorage)return;b.localStorage.setItem(v,JSON.stringify(u))}catch(a){}}function f(){return 0===u.length?null:w[u[0].requestID]?null:u[0]}function g(a){var b,c;for(d(a),b=0,c=u.length;c>b;b+=1)if(a===u[b].requestID){u.splice(b,1),e();break}}function h(a){var b,c,d=1,e=0;for(b=0;b<a.length;b+=1)d+=a.charCodeAt(b),e+=d;return d%=65521,e%=65521,c=65536*e+d,c.toString(16)}function i(c){if(!c)return"";try{return b.btoa(a._Utils.unencode(a._Utils.encode(c)))}catch(d){var e,f,g,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(e=0;e<c.length;e+=3)f=c.length-e,g=0,g=c.charCodeAt(e)<<16&16711680,g|=f>1?c.charCodeAt(e+1)<<8&65280:0,g|=f>2?255&c.charCodeAt(e+2):0,i.push(h.charAt((16515072&g)>>18)),i.push(h.charAt((258048&g)>>12)),i.push(f>1?h.charAt((4032&g)>>6):"_"),i.push(f>2?h.charAt(63&g):"_");return i.join("")}}function j(a,b){a=a.split("");var c,d=[];for(c=0;c<a.length;c+=1)d.push(i(b[a[c]]));return d.join("*")+"*"}function k(a){return("production"===a?r:s)+t}function l(e,f){function i(){e.callback&&e.callback.call(e,o),o.status>=200&&o.status<300?(g(e.requestID),f()):d(e.requestID)}var l,m,n,o,p=(new Date).getTime()-e.queueTime;p>1e3&&26784e5>p&&(e.offlineLag=p),delete e.queueTime,l="f="+e.format+"&d="+j(e.format,e.values),m="&c="+h(l);try{o=new b.XMLHttpRequest}catch(r){try{o=new b.ActiveXObject("Microsoft.XMLHttp")}catch(s){}}e.async&&(o.onreadystatechange=function(){4===o.readyState&&i()},o.onerror=i),c(e.requestID),n=["f=",e.format,"&","d=",l,"&","c=",m].join(""),q.developer&&a._Utils.log(k(e.environment)+"?"+n),o.open("POST",k(e.environment),e.async),o.send(n),e.async||i()}function m(a){a.queueTime=(new Date).getTime(),u.push(a),e()}function n(){var a=f();a&&l(a,n)}function o(a){m(a),n()}function p(){try{if(b.localStorage){var a=b.localStorage.getItem(v);a&&(u=JSON.parse(a))}}catch(c){}b.addEventListener&&b.addEventListener("online",n),n()}var q=a._self=a._self||{},r="http://stats.ft.com",s="http://statstest.ft.com",t="/si/track.gif",u=[],v="ft-tracking_requests",w={};return p(),{add:m,run:n,addAndRun:o}}(a,window),a._Utils=function(a,b,c){"use strict";function d(){m.developer&&b&&b.log.apply(null,arguments)}function e(a,b){return b||(b="undefined"),typeof a===b}function f(a,b){b||(b=a,a={});var c,d,e;for(c in b)d=a[c],e=b[c],a!==e&&"undefined"!=typeof e&&null!==e&&(a[c]=e);return a}function g(a){try{return c.encodeURIComponent(a)}catch(b){return c.escape(a)}}function h(a){try{return c.decodeURIComponent(a)}catch(b){return c.unescape(a)}}function i(a){if(!a)return"";var b,c=2166136261;for(b=0;b<a.length;b++)c+=(c<<1)+(c<<4)+(c<<7)+(c<<8)+(c<<24),c^=a.charCodeAt(b);return Number(4294967295&c).toString(16)}function j(a){if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}function k(a,b){var c,d=[];for(e(b)&&(b=[]),0===b.length&&(b=j(a)),c=0;c<b.length;c+=1)a.hasOwnProperty(b[c])&&d.push(b[c]+"="+g(a[b[c]]));return d.join("&")}function l(a){var b,c,d={};for(a=a.split("&"),b=0;b<a.length;b+=1)c=a[b].split("="),d[c[0]]=c.slice(1).join("=");return d}var m=a._self=a._self||{};return{log:d,is:e,isUndefined:e,merge:f,encode:g,unencode:h,hash:i,objectKeys:j,serialize:k,unserialize:l}}(a,console,window),a});